/* --------------------------------caregiver-ditail.html------------------  */
 
 /*✅ Ready for Django backend - Easy to populate with real data:
  <h5 class="mb-2 fw-bold">{{ caregiver.name }}</h5>
  <div class="fw-semibold">${{ caregiver.hourly_rate_min }}–${{ caregiver.hourly_rate_max }}/hr</div>

  {% for review in caregiver.reviews %}
    <div class="card border rounded-3 mb-3">
      <div class="card-body p-3">
        <h6 class="fw-semibold small mb-2">Reviewed by {{ review.author }}</h6>
        <p class="mb-0 small text-muted">{{ review.text }}</p>
      </div>
    </div>
  {% endfor %}
  */

  /* ----------------------enter_patient_details.html---------------- */
/* @app.route("/enter-patient-details", methods=["GET", "POST"])
def enter_patient_details():
    if request.method == "POST":
        data = {
            'address1': request.form.get('address1'),
            'address2': request.form.get('address2'),
            'country': request.form.get('country'),
            'state': request.form.get('state'),
            'city': request.form.get('city'),
            'pincode': request.form.get('pincode')
        }
        # Save to database
        # patient.save()
        return redirect(url_for('success'))
    
    return render_template("pages/enter_patient_details.html") */

    /* ----------------------- enter-member-details.html------------ */
    /* @app.route("/enter-member-details", methods=["GET", "POST"])
    def enter_member_details():
        if request.method == "POST":
            member = {
                'full_name': request.form.get('fullName'),
                'dob': request.form.get('dob'),
                'phone': request.form.get('phone'),
                'gender': request.form.get('gender'),
                'address1': request.form.get('address1'),
                'address2': request.form.get('address2'),
                'country': request.form.get('country'),
                'state': request.form.get('state'),
                'city': request.form.get('city'),
                'pincode': request.form.get('pincode')
            }
            # Save to database
            # db.session.add(member)
            # db.session.commit()
            return redirect(url_for('enter_patient_details'))
        
        return render_template("pages/enter-member-details.html") */

/* ------------------landingPage.html----------------- */
/* 
@app.route('/landing')
def landing():
    # Check if user already selected language
    # if 'lang' in session:
    #     return redirect(url_for('login'))
    return render_template('pages/landingPage.html')
 */

 /* --------------Login.html------------- */
 /* @app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        email = request.form.get('email')
        password = request.form.get('password')
        
        # Authenticate user
        user = User.query.filter_by(email=email).first()
        
        if user and user.check_password(password):
            # Store in session
            session['auth_flow'] = 'login'
            session['user_id'] = user.id
            
            # Send OTP
            send_otp(user.email)
            
            return redirect(url_for('otp_verify', **{'from': 'login'}))
        else:
            flash('Invalid credentials')
    
    return render_template('pages/login.html') */

/* --------------register.html--------------- */
/* @app.route('/register', methods=['GET', 'POST'])
def register():
    if request.method == 'POST':
        data = {
            'full_name': request.form.get('fullName'),
            'dob': request.form.get('dob'),
            'email': request.form.get('email'),
            'mobile': request.form.get('mobile'),
            'password': request.form.get('password'),
            'gender': request.form.get('gender')
        }
        
        # Check if user exists
        if User.query.filter_by(email=data['email']).first():
            flash('Email already registered')
            return redirect(url_for('register'))
        
        # Hash password
        hashed_password = generate_password_hash(data['password'])
        
        # Create user (but don't activate until OTP verified)
        user = User(
            full_name=data['full_name'],
            email=data['email'],
            password=hashed_password,
            is_verified=False
        )
        db.session.add(user)
        db.session.commit()
        
        # Store in session
        session['auth_flow'] = 'signup'
        session['user_id'] = user.id
        
        # Send OTP
        send_otp(user.email)
        
        return redirect(url_for('otp_verify', **{'from': 'signup'}))
    
    return render_template('pages/register.html') */

/* --------------otp-veri---------------- */
/* @app.route('/otp')
def otp_verify():
    otp_from = request.args.get('from', 'login')
    return render_template('pages/otp-verification.html', otp_from=otp_from)

@app.route('/api/verify-otp', methods=['POST'])
def verify_otp():
    data = request.get_json()
    otp = data.get('otp')
    email = data.get('email')
    otp_type = data.get('type')
    
    # Verify OTP from database or cache
    stored_otp = redis_client.get(f'otp:{email}')
    
    if stored_otp and stored_otp == otp:
        # OTP is valid
        if otp_type == 'signup':
            # Activate user account
            user = User.query.filter_by(email=email).first()
            user.is_verified = True
            db.session.commit()
            
        elif otp_type == 'forgot-password':
            # Generate password reset token
            token = generate_reset_token(email)
            session['reset_token'] = token
        
        # Delete used OTP
        redis_client.delete(f'otp:{email}')
        
        return jsonify({'success': True})
    else:
        return jsonify({'success': False, 'message': 'Invalid OTP'}), 400

@app.route('/api/resend-otp', methods=['POST'])
def resend_otp():
    data = request.get_json()
    email = data.get('email')
    otp_type = data.get('type')
    
    # Generate new OTP
    new_otp = generate_otp()
    
    # Store in Redis with 5-minute expiry
    redis_client.setex(f'otp:{email}', 300, new_otp)
    
    # Send email
    send_otp_email(email, new_otp, otp_type)
    
    return jsonify({'success': True}) */


/*-----------forget-password----------- */
/* @app.route('/forget-pass')
def forget_password():
    return render_template('pages/forget-password.html')

@app.route('/api/forgot-password', methods=['POST'])
def api_forgot_password():
    data = request.get_json()
    email = data.get('email')
    
    # Check if user exists
    user = User.query.filter_by(email=email).first()
    
    if not user:
        return jsonify({
            'success': False, 
            'message': 'No account found with this email'
        }), 404
    
    # Generate OTP
    otp = generate_otp()
    
    # Store OTP in Redis with 5-minute expiry
    redis_client.setex(f'otp:{email}', 300, otp)
    
    # Send email with OTP
    send_password_reset_email(email, otp, user.full_name)
    
    # Log the attempt
    logger.info(f'Password reset OTP sent to {email}')
    
    return jsonify({
        'success': True,
        'message': 'OTP sent to your email'
    }) */


/*----------reset-pass---------------*/
/* @app.route('/reset-pass')
def reset_password():
    # Check if user has valid reset token in session
    if 'reset_token' not in session:
        flash('Invalid or expired reset link')
        return redirect(url_for('forget_password'))
    
    return render_template('pages/reset-password.html')

@app.route('/api/reset-password', methods=['POST'])
def api_reset_password():
    data = request.get_json()
    email = data.get('email')
    password = data.get('password')
    token = data.get('token')
    
    # Verify token
    if not verify_reset_token(token, email):
        return jsonify({
            'success': False,
            'message': 'Invalid or expired reset token'
        }), 400
    
    # Get user
    user = User.query.filter_by(email=email).first()
    
    if not user:
        return jsonify({
            'success': False,
            'message': 'User not found'
        }), 404
    
    # Hash and update password
    user.password = generate_password_hash(password)
    db.session.commit()
    
    # Clear reset token
    redis_client.delete(f'reset_token:{email}')
    
    # Log the event
    logger.info(f'Password reset successful for {email}')
    
    # Send confirmation email
    send_password_changed_email(email, user.full_name)
    
    return jsonify({
        'success': True,
        'message': 'Password reset successfully'
    }) */

/*------------who need care-------------*/
/* @app.route('/whoneedcare')
def who_need_care():
    # Verify user is authenticated and verified
    if 'user_id' not in session or not session.get('is_verified'):
        return redirect(url_for('register'))
    
    return render_template('pages/who-need-care.html')

@app.route('/api/care-needs', methods=['POST'])
def save_care_needs():
    data = request.get_json()
    user_id = session.get('user_id')
    
    # Create care needs record
    care_need = CareNeed(
        user_id=user_id,
        who_needs_care=data.get('whoNeedsCare'),
        age=data.get('age'),
        postcode=data.get('postcode'),
        help_option=data.get('helpOption'),
        services=json.dumps(data.get('services'))
    )
    
    db.session.add(care_need)
    db.session.commit()
    
    return jsonify({
        'success': True,
        'care_need_id': care_need.id
    }) */


/*
 To Enable Backend Integration:
Simply uncomment the backend integration sections in each route!

Example:

Python

# Change this:
# response = make_api_request('auth/login', method='POST', data={...})

# To this (remove # comments):
response = make_api_request('auth/login', method='POST', data={...})

*/